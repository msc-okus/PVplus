{% import _self as macros %}

{% macro availabilityTable(availability, aktAnlage, days) %}
    {% set pa0   = 0 %}
    {% set pa1   = 0 %}
    {% set pa2   = 0 %}
    {% set pa3   = 0 %}
    {% set case0 = 0 %}
    {% set case1 = 0 %}
    {% set case2 = 0 %}
    {% set case3 = 0 %}
    {% set case4 = 0 %}
    {% set case5 = 0 %}
    {% set case6 = 0 %}
    {% set control = 0 %}
    <div data-controller="toggle-by-class">
        <table id="statusTable" class="table stickyheader" data-show-hide-availabillity-target ="table1">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Inverter</th>
                    <th></th>
                    <th>Case 0</th>
                    <th>Case 1</th>
                    <th>Case 2</th>
                    <th>Case 3</th>
                    <th>Case 4</th>
                    <th>Case 5</th>
                    <th>Case 6</th>
                    <th>Control</th>
                    <th>Avail. cases [%]</th>
                    <th>Rel. avail. plant [%]</th>
                </tr>
            </thead>
            <tbody>
            {% for stati in availability %}
                <tr>
                    <td>{{ stati.stamp|date("Y-m-d") }} </td>
                    <td style="text-align: left;">{% if aktAnlage.inverterFromAnlage[stati.inverter] is defined() %}{{ aktAnlage.inverterFromAnlage[stati.inverter] }}{% endif %} <br> ({{ stati.inverter }})</td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">PA.0 (Open Book) </span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">PA.1 ({{ aktAnlage.eigner.settings.nameDep1 }})</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">PA.2 ({{ aktAnlage.eigner.settings.nameDep2 }})</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">PA.3 ({{ aktAnlage.eigner.settings.nameDep3 }})</span>{% endif %}
                    </td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">{{ stati.case00 }} / {{ stati.case00 / 4 }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">{{ stati.case01 }} / {{ stati.case01 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">{{ stati.case02 }} / {{ stati.case02 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">{{ stati.case03 }} / {{ stati.case03 / 4 }}</span>{% endif %}
                    </td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">{{ stati.case10 }} / {{ stati.case10 / 4 }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">{{ stati.case11 }} / {{ stati.case11 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">{{ stati.case12 }} / {{ stati.case12 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">{{ stati.case13 }} / {{ stati.case13 / 4 }}</span>{% endif %}

                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case20 }} / {{ stati.case20 / 4 }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span class="topline js-pa-1">{{ stati.case21 }} / {{ stati.case21 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span class="topline js-pa-2">{{ stati.case22 }} / {{ stati.case22 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span class="topline js-pa-3">{{ stati.case23 }} / {{ stati.case23 / 4 }}</span>{% endif %}
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case30 }} / {{ stati.case30 / 4 }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span class="topline js-pa-1">{{ stati.case31 }} / {{ stati.case31 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span class="topline js-pa-2">{{ stati.case32 }} / {{ stati.case32 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span class="topline js-pa-3">{{ stati.case33 }} / {{ stati.case33 / 4 }}</span>{% endif %}
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case40 }} / {{ stati.case40 / 4 }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span class="topline js-pa-1">{{ stati.case41 }} / {{ stati.case41 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span class="topline js-pa-2">{{ stati.case42 }} / {{ stati.case42 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span class="topline js-pa-3">{{ stati.case43 }} / {{ stati.case43 / 4 }}</span>{% endif %}
                    </td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">{{ stati.case50 }} / {{ stati.case50 / 4 }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">{{ stati.case51 }} / {{ stati.case51 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">{{ stati.case52 }} / {{ stati.case52 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">{{ stati.case53 }} / {{ stati.case53 / 4 }}</span>{% endif %}
                    </td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">{{ stati.case60 }} / {{ stati.case60 / 4 }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">{{ stati.case61 }} / {{ stati.case61 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">{{ stati.case62 }} / {{ stati.case62 / 4 }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">{{ stati.case63 }} / {{ stati.case63 / 4 }}</span>{% endif %}
                    </td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">{{ stati.control0}} / {{ stati.control0 / 4}}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">{{ stati.control1 }} / {{ stati.control1 / 4}}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">{{ stati.control2 }} / {{ stati.control2 / 4}}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">{{ stati.control3 }} / {{ stati.control3 / 4}}</span>{% endif %}
                    </td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">{{ stati.invAPart10|number_format(2, ',', '.') }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">{{ stati.invAPart11|number_format(2, ',', '.') }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">{{ stati.invAPart12|number_format(2, ',', '.') }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">{{ stati.invAPart13|number_format(2, ',', '.') }}</span>{% endif %}
                    </td>
                    <td class="toggle_visibility_td">
                        <span class="topline js-pa-0">{{ (stati.invA0 / days)|number_format(4, ',', '.') }}</span>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<span data-toggle-one-target = "item" class="topline js-pa-1">{{ (stati.invA1 / days)|number_format(4, ',', '.') }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<span data-toggle-two-target = "item" class="topline js-pa-2">{{ (stati.invA2 / days)|number_format(4, ',', '.') }}</span>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<span data-toggle-three-target = "item" class="topline js-pa-3">{{ (stati.invA3 / days)|number_format(4, ',', '.') }}</span>{% endif %}
                    </td>
                </tr>
                {% set pa0 = pa0 + stati.invA0 %}
                {% set pa1 = pa1 + stati.invA1 %}
                {% set pa2 = pa2 + stati.invA2 %}
                {% set pa3 = pa3 + stati.invA3 %}
                {% set case0 = case0 + stati.case02 %}
                {% set case1 = case1 + stati.case12 %}
                {% set case2 = case2 + stati.case22 %}
                {% set case3 = case3 + stati.case32 %}
                {% set case4 = case4 + stati.case42 %}
                {% set case5 = case5 + stati.case52 %}
                {% set case6 = case6 + stati.case62 %}
                {% set control = control + stati.control2 %}
            {% endfor %}
            <tr>
                <td> </td>
                <td></td>
                <td></td>
                <td>{{ case0 }} / {{ case0 / 4 }}</td>
                <td>{{ case1 }} / {{ case1 / 4 }}</td>
                <td>{{ case2 }} / {{ case2 / 4 }}</td>
                <td>{{ case3 }} / {{ case3 / 4 }}</td>
                <td>{{ case4 }} / {{ case4 / 4 }}</td>
                <td>{{ case5 }} / {{ case5 / 4 }}</td>
                <td>{{ case6 }} / {{ case6 / 4 }}</td>
                <td>{{ control }} / {{ control / 4 }}</td>
                <td></td>
                <td>
                    <span class="js-pa-0"><b>PA 0: </b>{{ (pa0 / days)|number_format(4, ',', '.') }}<br></span>
                    <span class="js-pa-1">{% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}<b>PA 1: </b>{{ (pa1 / days)|number_format(4, ',', '.') }}<br>{% endif %}</span>
                    <span class="js-pa-2">{% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}<b>PA 2: </b>{{ (pa2 / days)|number_format(4, ',', '.') }}<br>{% endif %}</span>
                    <span class="js-pa-3">{% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}<b>PA 3: </b>{{ (pa3 / days)|number_format(4, ',', '.') }}{% endif %}</span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
{% endmacro availabilityTable %}



<div class="grid-x grid-margin-x">
    <div class="cell medium-9">
        {{ macros.availabilityTable(content.availability, aktAnlage, content.days) }}
    </div>
    <div class="cell medium-3">
        <div class="callout secondary text-left" >
            <h4><b>Explanation</b></h4>
            <dl>
                <dt>Case 0</dt>
                <dd>data gap<br>
                    <small></small></dd>

                <dt>Case 1 (t<sub>i</sub> - part 1)</dt>
                <dd>irradiation below limit value<br>
                    <small><code>G [W/qm] > <b>threshold1</b> && G [W/qm] <= <b>threshold2</b></code></small></dd>

                <dt>Case 2 (t<sub>i</sub> - part 2)</dt>
                <dd>inverter available under operating conditions<br>
                    <small><code>G [W/qm] > <b>threshold2</b></code></small>
                    <br>(sum from case1 and case 2 are t<sub>i</sub>)
                </dd>

                <dt>Case 3</dt>
                <dd>inverter not available under operating conditions<br>
                    <small>G [W/qm] > threshold2 && Pac [kWh] <= 0</small></dd>

                <dt>Case 4</dt>
                <dd>inverter not available because of curtailment<br>
                    <small><code>G [W/qm] > <b>threshold2</b> && Pac [kWh] > 0 && CosPhi = 0</code></small></dd>

                <dt>Case 5 (t<sub>iFM</sub>)</dt>
                <dd>inverter not available because of force majour<br>
                    <small></small></dd>

                <dt>Case 6</dt>
                <dd>data gap are defined to unavialability<br>
                    <small></small></dd>

                <dt>Control (t<sub>i,theo</sub>)</dt>
                <dd><small><code>G [W/qm] > 0</code></small></dd>

                <dt>Availability cases</dt>
                <dd> the individual availability of an inverter or group.<br>Full availability: 100%</dd>

                <dt>Relative availability in plant</dt>
                <dd> the relative availability of and inverter or group within the PV plant. Full availability is equal to the ratio of inverter power to total plant power. Total plant availability: the sum of all relative inverter availabilities.</dd>

                <dt>Definition threshold</dt>
                <dd>
                    <small>
                        OpenBook: threshold1 = {{ aktAnlage.threshold1PA0 }}, threshold2 = {{ aktAnlage.threshold2PA0 }}<br>
                        {% if not(aktAnlage.settings.disableDep1) and (aktAnlage.eigner.features.aktDep1) %}{{ aktAnlage.eigner.settings.nameDep1 }}: threshold1 = {{ aktAnlage.threshold1PA1 }}, threshold2 = {{ aktAnlage.threshold2PA1 }}<br>{% endif %}
                        {% if not(aktAnlage.settings.disableDep2) and (aktAnlage.eigner.features.aktDep2) %}{{ aktAnlage.eigner.settings.nameDep2 }}: threshold1 = {{ aktAnlage.threshold1PA2 }}, threshold2 = {{ aktAnlage.threshold2PA2 }}<br>{% endif %}
                        {% if not(aktAnlage.settings.disableDep3) and (aktAnlage.eigner.features.aktDep3) %}{{ aktAnlage.eigner.settings.nameDep3 }}: threshold1 = {{ aktAnlage.threshold1PA3 }}, threshold2 = {{ aktAnlage.threshold2PA3 }}{% endif %}
                    </small>
                </dd>
            </dl>
        </div>
    </div>
</div>

