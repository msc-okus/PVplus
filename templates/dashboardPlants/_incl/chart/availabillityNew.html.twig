{% import _self as macros %}

{% macro availabilityTable(availability, aktAnlage) %}
    {% set pa = 0 %}
    {% set case0 = 0 %}
    {% set case1 = 0 %}
    {% set case2 = 0 %}
    {% set case3 = 0 %}
    {% set case4 = 0 %}
    {% set case5 = 0 %}
    {% set case6 = 0 %}
    {% set control = 0 %}
    <div class="status-log" style="margin: 0 25px 0 10px;">
        <table id="statusTable" style="width: 100%;">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Inverter</th>
                    <th></th>
                    <th>Case 0</th>
                    <th>Case 1</th>
                    <th>Case 2</th>
                    <th>Case 3</th>
                    <th>Case 4</th>
                    <th>Case 5</th>
                    <th>Case 6</th>
                    <th>Control</th>
                    <th>Avail. cases [%]</th>
                    <th>Rel. avail. plant [%]</th>
                </tr>
            </thead>
            <tbody>
            {% for stati in availability %}
                <tr>
                    <td>{{ stati.stamp|date("Y-m-d") }} </td>
                    <td style="text-align: left;">{{ aktAnlage.inverterFromAnlage[stati.inverter] }} <br> ({{ stati.inverter }})</td>
                    <td>
                        <span class="topline js-pa-0" style="text-align: left;">PA.0 (Open Book)</span>
                        <span class="topline js-pa-1" style="text-align: left;">PA.1 ({{ aktAnlage.eigner.settings.nameDep1 }})</span>
                        <span class="topline js-pa-2" style="text-align: left;">PA.2 ({{ aktAnlage.eigner.settings.nameDep2 }})</span>
                        <span class="topline js-pa-3" style="text-align: left;">PA.3 ({{ aktAnlage.eigner.settings.nameDep3 }})</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case00 }} / {{ stati.case00 / 4 }}</span>
                        <span class="topline js-pa-1">{{ stati.case01 }} / {{ stati.case01 / 4 }}</span>
                        <span class="topline js-pa-2">{{ stati.case02 }} / {{ stati.case02 / 4 }}</span>
                        <span class="topline js-pa-3">{{ stati.case03 }} / {{ stati.case03 / 4 }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case10 }} / {{ stati.case10 / 4 }}</span>
                        <span class="topline js-pa-1">{{ stati.case11 }} / {{ stati.case11 / 4 }}</span>
                        <span class="topline js-pa-2">{{ stati.case12 }} / {{ stati.case12 / 4 }}</span>
                        <span class="topline js-pa-3">{{ stati.case13 }} / {{ stati.case13 / 4 }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case20 }} / {{ stati.case20 / 4 }}</span>
                        <span class="topline js-pa-1">{{ stati.case21 }} / {{ stati.case21 / 4 }}</span>
                        <span class="topline js-pa-2">{{ stati.case22 }} / {{ stati.case22 / 4 }}</span>
                        <span class="topline js-pa-3">{{ stati.case23 }} / {{ stati.case23 / 4 }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case30 }} / {{ stati.case30 / 4 }}</span>
                        <span class="topline js-pa-1">{{ stati.case31 }} / {{ stati.case31 / 4 }}</span>
                        <span class="topline js-pa-2">{{ stati.case32 }} / {{ stati.case32 / 4 }}</span>
                        <span class="topline js-pa-3">{{ stati.case33 }} / {{ stati.case33 / 4 }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case40 }} / {{ stati.case40 / 4 }}</span>
                        <span class="topline js-pa-1">{{ stati.case41 }} / {{ stati.case41 / 4 }}</span>
                        <span class="topline js-pa-2">{{ stati.case42 }} / {{ stati.case42 / 4 }}</span>
                        <span class="topline js-pa-3">{{ stati.case43 }} / {{ stati.case43 / 4 }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case50 }} / {{ stati.case50 / 4 }}</span>
                        <span class="topline js-pa-1">{{ stati.case51 }} / {{ stati.case51 / 4 }}</span>
                        <span class="topline js-pa-2">{{ stati.case52 }} / {{ stati.case52 / 4 }}</span>
                        <span class="topline js-pa-3">{{ stati.case53 }} / {{ stati.case53 / 4 }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.case60 }} / {{ stati.case60 / 4 }}</span>
                        <span class="topline js-pa-1">{{ stati.case61 }} / {{ stati.case61 / 4 }}</span>
                        <span class="topline js-pa-2">{{ stati.case62 }} / {{ stati.case62 / 4 }}</span>
                        <span class="topline js-pa-3">{{ stati.case63 }} / {{ stati.case63 / 4 }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.control0}} / {{ stati.control0 / 4}}</span>
                        <span class="topline js-pa-1">{{ stati.control1 }} / {{ stati.control1 / 4}}</span>
                        <span class="topline js-pa-2">{{ stati.control2 }} / {{ stati.control2 / 4}}</span>
                        <span class="topline js-pa-3">{{ stati.control3 }} / {{ stati.control3 / 4}}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.invAPart10|number_format(2, ',', '.') }}</span>
                        <span class="topline js-pa-1">{{ stati.invAPart11|number_format(2, ',', '.') }}</span>
                        <span class="topline js-pa-2">{{ stati.invAPart12|number_format(2, ',', '.') }}</span>
                        <span class="topline js-pa-3">{{ stati.invAPart13|number_format(2, ',', '.') }}</span>
                    </td>
                    <td>
                        <span class="topline js-pa-0">{{ stati.invA0|number_format(4, ',', '.') }}</span>
                        <span class="topline js-pa-1">{{ stati.invA1|number_format(4, ',', '.') }}</span>
                        <span class="topline js-pa-2">{{ stati.invA2|number_format(4, ',', '.') }}</span>
                        <span class="topline js-pa-3">{{ stati.invA3|number_format(4, ',', '.') }}</span>
                    </td>
                </tr>
                {% set pa = pa + stati.invA2 %}
                {% set case0 = case0 + stati.case02 %}
                {% set case1 = case1 + stati.case12 %}
                {% set case2 = case2 + stati.case22 %}
                {% set case3 = case3 + stati.case32 %}
                {% set case4 = case4 + stati.case42 %}
                {% set case5 = case5 + stati.case52 %}
                {% set case6 = case6 + stati.case62 %}
                {% set control = control + stati.control2 %}
            {% endfor %}
            <tr>
                <td> </td>
                <td></td>
                <td></td>
                <td>{{ case0 }} / {{ case0 / 4 }}</td>
                <td>{{ case1 }} / {{ case1 / 4 }}</td>
                <td>{{ case2 }} / {{ case2 / 4 }}</td>
                <td>{{ case3 }} / {{ case3 / 4 }}</td>
                <td>{{ case4 }} / {{ case4 / 4 }}</td>
                <td>{{ case5 }} / {{ case5 / 4 }}</td>
                <td>{{ case6 }} / {{ case6 / 4 }}</td>
                <td>{{ control }} / {{ control / 4 }}</td>
                <td></td>
                <td>{{ pa|number_format(4, ',', '.') }}</td>
            </tr>
            </tbody>
        </table>
    </div>
{% endmacro availabilityTable %}



<div class="grid-x">
    <div class="cell medium-9">
        {{ macros.availabilityTable(content.availability, aktAnlage) }}
    </div>
    <div class="cell medium-3">
        <div class="callout secondary text-left" >
            <h4><b>Explanation</b></h4>
            <dl>
                <dt>Case 0</dt>
                <dd>data gap<br>
                    <small></small></dd>

                <dt>Case 1</dt>
                <dd>irradiation below limit value<br>
                    <small>G [W/qm] > {{ aktAnlage.threshold1PA }} && G [W/qm] <= {{ aktAnlage.threshold2PA }}</small></dd>

                <dt>Case 2 (t<sub>i</sub>)</dt>
                <dd>inverter available under operating conditions<br>
                    <small>G [W/qm] > {{ aktAnlage.threshold2PA }}</small></dd>

                <dt>Case 3</dt>
                <dd>inverter not available under operating conditions<br>
                    <small>G [W/qm] > {{ aktAnlage.threshold2PA }} && Pac [kWh] <= 0</small></dd>

                <dt>Case 4</dt>
                <dd>inverter not available because of curtailment<br>
                    <small>G [W/qm] > {{ aktAnlage.threshold2PA }} && Pac [kWh] > 0 && CosPhi = 0</small></dd>

                <dt>Case 5 (t<sub>iFM</sub>)</dt>
                <dd>inverter not available because of maintenance<br>
                    <small></small></dd>

                <dt>Case 6</dt>
                <dd>data gap are defined to unavialability<br>
                    <small></small></dd>

                <dt>Control (t<sub>i,theo</sub>)</dt>
                <dd>control field case 1 + case 2 + case 5 + case 6<br>
                    <small>G [W/qm] > 0</small></dd>

                <dt>Availability cases</dt>
                <dd> the individual availability of an inverter or group. Full availability: 100%<br>
                    <!--<small>G [W/qm] > 0</small>--></dd>

                <dt>Relative availability in plant</dt>
                <dd> the relative availability of and inverter or group within the PV plant. Full availability is equal to the ratio of inverter power to total plant power. Total plant availability: the sum of all relative inverter availabilities.  <br>
                    <!--<small>G [W/qm] > 0</small>--></dd>

            </dl>
        </div>
    </div>
</div>

