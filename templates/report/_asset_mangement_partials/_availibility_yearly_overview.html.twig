{% extends 'report/_asset_mangement_partials/_pageBase.html.twig' %}

{% block page %}
    <h3 style="color: {{ anlage.eigner.fontColor2 }};">Availability â€“ Yearly Overview</h3>
    {% set countinverters = 0 %}
    <table >
        <tr>
            <td style="vertical-align: top;">
                {% set itemcounter = 1 %}
                {% set itemcounter2 = 0 %}
                {% set unitcounter = 0 %}
                {% set unitcounter2 = 0 %}
                {% if (page == (((invNr / 20)|round(0, 'ceil'))-1)) %}

                    {% if  (invNr % 20) != 0 %}
                        {% set maxInv = (invNr % 20) %}
                    {% else %}
                        {% set maxInv =  20 %}
                    {% endif %}

                {% else  %}
                    {% set maxInv =  20 %}
                {% endif %}

                <table class="asset_report_table_operations_data" style="margin-bottom: 5px!important; width: 100%!important;">
                    <tr>
                    {% for inv in 0..maxInv-1 %}

                        {%  set data = plantAvailabilityCurrentYear[(page*20)+inv] %}
                        <td style = 'border: none !important; padding:0 !important;vertical-align: bottom !important;'>
                            <table class = "" style="margin:0 !important; width: 100%!important;">
                                <thead>
                                {% if (itemcounter == 1 ) %}
                                    <tr>
                                        <th style="padding:0 !important;margin:0 !important;font-size: 7.3px!important; border-right: 0px!important; text-align: center;" rowspan="3" style="border-left: solid 1px !important;">Month</th>
                                        <th style=" height:28px; padding:0 !important;margin:0 !important;font-size: 7.3px!important; border-right: 0px!important; text-align: center;">{{ acGroups[(page*20)+inv] }}</th>
                                    </tr>
                                    <tr><th style="padding:0 !important;margin:0 !important;font-size: 7.3px!important; border-right: 0px!important; text-align: center;">[%]</th></tr>
                                {% endif %}
                                {% if (itemcounter > 1) %}
                                    {% if loop.last %}
                                        <tr><th style=" height:28px; padding:0 !important;margin:0 !important;font-size: 7.3px!important; text-align: center;">{{ acGroups[(page*20)+inv] }}</th></tr>
                                        <tr><th style="padding:0 !important;margin:0 !important;font-size: 7.3px!important;  text-align: center;">[%]</th></tr>
                                    {% else %}
                                        <tr><th style=" height:28px; padding:0 !important;margin:0 !important;font-size: 7.3px!important; border-right: 0px!important; text-align: center;">{{ acGroups[(page*20)+inv] }}</th></tr>
                                        <tr><th style="padding:0 !important;margin:0 !important;font-size: 7.3px!important; border-right: 0px!important; text-align: center;">[%]</th></tr>
                                    {% endif %}

                                {% endif %}
                                </thead>
                                {% set color = "#ffffff" %}
                                {% for datatr in data %}
                                    {% if (datatr.pa >= 98) %}  {% set color = "#00b050" %}{% endif %}
                                    {% if (datatr.pa < 98) %}   {% set color = "#cee4c0" %}{% endif %}
                                    {% if (datatr.pa < 92) %}   {% set color = "#ffff00" %}{% endif %}
                                    {% if (datatr.pa < 85) %}   {% set color = "#ffc000" %}{% endif %}
                                    {% if (datatr.pa <= 80) %}  {% set color = "#cc0000" %}{% endif %}
                                    {% if (datatr.pa == 100) %} {% set color = "#00b050" %}{% endif %}

                                    {% if (itemcounter == 1 ) %}
                                        <tr><td class="tr_first_column" style="font-size: 7.3px!important;">{{ datatr.form_date }}</td><td class="tr_next_columns" style="font-size: 7.3px!important;background-color:{{ color }};">{{ datatr.pa|number_format(0, ',', '.') }}</td></tr>
                                    {% endif %}
                                    {% if (itemcounter > 1) %}
                                        <tr><td class="tr_next_columns" style="font-size: 7.3px!important;background-color:{{ color }};">{{ datatr.pa|number_format(0, ',', '.') }}</td></tr>
                                    {% endif %}
                                {% endfor %}
                            </table>
                        </td>
                        {% set unitcounter2 = unitcounter2+1 %}
                        {% set itemcounter = itemcounter+1 %}
                    {% endfor %}
                    {% set itemcounter = 1 %}

                    </tr>
                </table>
                        {#
                        {%  set data = plantAvailabilityMonth[(page*40)+inv] %}
                        {% set countinverters = data[0]|length %}
                        {% if (itemcounter == 1 ) %}
                            <tr>
                                <td class="tr_first_column" style="padding:0 !important; border-right: 0px!important; width: 70px!important; text-align: center;">
                                    Month
                                </td>
                                {% for datatr in data[0] %}
                                    {% if(unitcounter2 < countinverters / 2) %}
                                        {% if unitcounter2 == (countinverters / 2) - 1 %}
                                            <td style="padding:0 !important; border-right:solid 1px!important;">
                                                <table class = "streamdayly" style="padding:0 !important; margin:0 !important;">
                                                    <tr><th style="padding:0 !important;margin:0 !important; height:28px; width:54px; border-right: 0px!important; text-align: center;">{{ acGroups[unitcounter2] }}</th></tr>
                                                    <tr><th style="padding:0 !important;margin:0 !important; border-right: 0px!important; text-align: center;">[%]</th></tr>
                                                </table>
                                            </td>
                                        {% else %}
                                            <td style="padding:0 !important; border-right:0px!important;">
                                                <table class = "streamdayly" style="padding:0 !important; margin:0 !important;">
                                                    <tr><th style="padding:0 !important;margin:0 !important; height:28px; width:54px; border-right: 0px!important; text-align: center;">{{ acGroups[unitcounter2] }}</th></tr>
                                                    <tr><th style="padding:0 !important;margin:0 !important; border-right: 0px!important; text-align: center;">[%]</th></tr>
                                                </table>
                                            </td>
                                        {% endif %}
                                    {% endif %}
                                    {% set unitcounter2 = unitcounter2+1 %}
                                {% endfor %}
                            </tr>
                        {% endif %}
                        {% set color = "#ffffff" %}


                        <tr>
                            {% for datatr in data %}
                                {% if (datatr.pa >= 98) %}{% set color = "#00b050" %}{% endif %}
                                {% if (datatr.pa < 98) %}{% set color = "#cee4c0" %}{% endif %}
                                {% if (datatr.pa < 92) %}{% set color = "#ffff00" %}{% endif %}
                                {% if (datatr.pa < 85) %}{% set color = "#ffc000" %}{% endif %}
                                {% if (datatr.pa <= 80) %}{% set color = "#cc0000" %}{% endif %}
                                {% if (datatr.pa == 100) %}{% set color = "#00b050" %}{% endif %}
                                {% if (unitcounter == 0 ) %}
                                    <td class="tr_first_column">{{ montharray[itemcounter2] }}</td>
                                    <td class="tr_next_columns" style="background-color:{{ color }};">{{ datatr.pa|number_format(2, ',', '.') }}</td>
                                {% endif %}
                                {% if (unitcounter > 0 and unitcounter < countinverters/2) %}
                                    <td class="tr_next_columns"style="background-color:{{ color }};">{{ datatr.pa|number_format(2, ',', '.') }}</td>
                                {% endif %}
                                {% set unitcounter = unitcounter+1 %}
                            {% endfor %}
                            {% set unitcounter = 0 %}
                        </tr>

                        {% set itemcounter = itemcounter+1 %}
                        {% set itemcounter2 = itemcounter2+1 %}
                    {% endfor %}
                    {% set itemcounter = 1 %}
                    {% set itemcounter2 = 0 %}
                </table>
            </td>
        </tr>
            #}
        <tr>
            <td style="text-align: right!important; float: right;">
                <table class="legend_colors" style="margin-bottom: 0!important;">
                    <tr>
                        <td rowspan="2" style=" text-align: center;">Explanation</td>
                        <td>0-2%</td>
                        <td>2,1-8%</td>
                        <td>8,1-15%</td>
                        <td>15,1-20%</td>
                        <td>20%-</td>
                    </tr>
                    <tr>
                        <td style="background-color: #00b050;">&nbsp;</td>
                        <td style="background-color: #cee4c0;">&nbsp;</td>
                        <td style="background-color: #ffff00;">&nbsp;</td>
                        <td style="background-color: #ffc000;">&nbsp;</td>
                        <td style="background-color: #cc0000;">&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

{% endblock page %}