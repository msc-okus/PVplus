{% extends "base.html.twig" %}

{% block title %}

{% endblock %}

{% block styles %}
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css">
    {{ parent() }}
{% endblock %}

{% block javascriptstop %}
    {{ parent() }}

{% endblock %}

{% block javascripts %}
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
    {{ parent() }}
    <script src="https://cdn.amcharts.com/lib/4/core.js" type="text/javascript"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js" type="text/javascript"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js" type="text/javascript"></script>
    {{ encore_entry_script_tags('dashboard') }}
{% endblock %}

{% block body %}
<div class="tabs-content" data-tabs-content="all-tabs">
    <!-- Existing Tab Titles -->
    <ul class="tabs" data-tabs id="all-tabs">
        <li class="tabs-title "><a href="#plantTab" aria-selected="true">Plants</a></li>
        <li class="tabs-title " id="ticketTab" style="position: relative;"></li>
        <li class="tabs-title " id="reportTab"></li>

    </ul>

    <!-- Existing Tab Content -->
    <div class="tabs-panel " id="plantTab">
        <div id="ownerNew" data-controller="newdashboard newticket">

            {% if is_granted('ROLE_G4N') %}
                <div id="1" class="grid-x">
                    <div class="cell small-12 medium-3">
                        <select id="companyFilter" >
                            <option value="">Select a Company</option>
                            {% for owner in content %}
                                <option value="{{ owner.firma }}">{{ owner.firma }}</option>
                            {% endfor %}
                        </select>
                    </div>

                </div>
            {% endif %}

            <div   class="grid-x grid-margin-x ">
                <div class="cell large-12 medium-12 small-12 ">
                    <table id="new_dashboard" class=" striped  hover nowrap" style="width: 100%" >
                        <thead>
                        <tr>
                            <th>Project Nr</th>
                            <th>Plant Name</th>
                            <th>Plant Owner</th>
                            <th>Pnom</th>
                            <th>Flag</th>
                            <th>Country</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {#                    {{ dump(content[0].activeAnlage) }}#}
                        {% for owner in content %}
                            {% for plant in owner.activeAnlage(is_granted('ROLE_G4N')) %}
                                {% if plant.anlId in app.user.grantedList or is_granted('ROLE_G4N') %}
                                    <tr>
                                        <td>{{ plant.projektNr }}</td>
                                        <td>{{ plant.anlName }}</td>
                                        <td>{{ owner.firma }}</td>
                                        <td>{{ plant.getPnom }}</td>
                                        <td><img height='25' width='25' style='margin-top: -9px;' src='/images/flag/flag-{{ plant.country }}.png'  alt="{{ plant.country }}"/></td>
                                        <td>{{ plant.country }}</td>
                                        <td style="justify-items: center">
                                            <ul style="display: flex; justify-content: space-between; align-items: center;padding: 0; margin: 0;" >
                                                <button class="button button-icon round-corner chart"
                                                        data-anlage="{{ plant.anlId }}"
                                                        data-anlage-name="{{ plant.anlName }}"
                                                        style="padding: 2px;margin: 0;">
                                                    Charts
                                                </button>
                                                <button class="button button-icon round-corner"
                                                        data-anlage="{{ plant.anlId }}"
                                                        data-anlage-name="{{ plant.anlName }}"
                                                        style="color:red;padding: 2px;margin: 0;"
                                                        onclick="window.location.href='{{ path('app_newDashboard_plant', {'anlageId': plant.anlId}) }}';"
                                                >
                                                    Charts
                                                </button>


                                                <button class="button button-icon round-corner ticket-btn"
                                                        data-anlage="{{ plant.anlId }}"
                                                        data-anlage-name="{{ plant.anlName }}"
                                                        style="padding: 2px;margin: 0;">
                                                    Tickets
                                                </button>
                                                <button class="button button-icon round-corner report-btn"
                                                        data-anlage="{{ plant.anlId }}"
                                                        style="padding: 2px;margin: 0;">
                                                    Reports
                                                </button>
                                            </ul>
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                        </tbody>
                    </table>
                    <div id="loadingGif" style=" position:fixed; top:0;left:0; width:100%;height:100%;display: none; justify-content: center; align-items: center; background-color:transparent;z-index: 10000;">
                        <img src="/images/loading.gif" width="100" height="100">
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="tabs-panel " id="anlTicketTab"></div>
    <div class="tabs-panel " id="anlReportTab"></div>
</div>
{% endblock %}



